(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();var f=t=>t instanceof HTMLElement||t instanceof DocumentFragment,L=class{constructor(){this.listeners={}}addEventListener(t,i){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(i)}dispatchEvent(t,i){var n;const e=this.listeners[t]||[];for(;e.length!==0;)(n=e.shift())==null||n.call(void 0,i)}},v=new L;function C(t){const i=new DocumentFragment;for(let e of t)if(Array.isArray(e))i.appendChild(C(e));else{if(e instanceof S&&(e=e.render(void 0)),typeof e=="function"&&(e=e(),typeof e=="function"&&(e=e())),typeof e=="string"||typeof e=="number"){i.appendChild(document.createTextNode(e));continue}if(f(e))i.appendChild(e);else if(typeof e<"u")throw new Error("  ✘  Cradova err:  invalid child type: "+e+" ("+typeof e+")")}return i}var S=class{constructor(t){this.effects=[],this.effectuate=null,this.rendered=!1,this.published=!1,this.preRendered=null,this.reference=new m,this._state=[],this._state_track={},this._state_index=0,this.component=t.bind(this)}preRender(t){let i=this.component(t);if(typeof i=="function"&&(i=i()),f(i)&&(this.preRendered=i),!this.preRendered)throw new Error(" ✘  Cradova err :  Invalid component type for cradova Ref got  -  "+this.preRendered);this.reference._appendDomForce("html",this.preRendered)}destroyPreRendered(){this.preRendered=null}render(t,i){this.effects=[],this.rendered=!1;let e=this.component(t);return typeof e=="function"&&(e=e()),e||(e=this.preRendered),i&&(this.stash=t),f(e)?(this.reference._appendDomForce("html",e),this.effector.apply(this),this.rendered=!0,this.published=!0):console.error(" ✘  Cradova err :  Invalid html content, got  - "+e),e}instance(){return this.reference.html}_setExtra(t){this.Signal=t}_roll_state(t,i,e=!1){return e||(this._state[i]=t),this._state[i]}_effect(t){this.rendered||this.effects.push(t.bind(this))}async effector(){if(!this.rendered){for(let t=0;t<this.effects.length;t++)await this.effects[t].apply(this);this.effects=[]}this.effectuate&&(this.effectuate(),this.effectuate=null)}updateState(t,i){this.rendered?this.published&&this.Activate(t):this.effectuate=()=>{this.published&&this.Activate(t)},i&&(this.stash=t)}async Activate(t){if(this._state_index=0,this.published=!1,!this.rendered)return;let i=this.component(t);typeof i=="function"&&(i=i()),f(i)?(this.reference.html.insertAdjacentElement("beforebegin",i),this.reference.html.remove(),this.published=!0,this.reference._appendDomForce("html",i),v.dispatchEvent("onmountEvent")):console.error(" ✘  Cradova err :  Invalid html content, got  - "+i)}},_=function(t){const i=document.createDocumentFragment();for(let e=0;e<t.length;e++){let n=t[e];if(typeof n=="function"&&(n=n()),f(n)){i.appendChild(n);continue}if(n instanceof String){i.appendChild(document.createTextNode(n));continue}throw console.error(" ✘  Cradova err:   wrong element type"+n),new TypeError(" ✘  Cradova err:   invalid element")}return i},m=class{bindAs(t){return[this,t]}_appendDomForce(t,i){this[t]=i}};function w(t,i){if(t){if(typeof i=="object"&&!Array.isArray(i))for(const e in i){if(e==="style"&&typeof i[e]=="object"){for(const[r,o]of Object.entries(i[e]))if(typeof t.style[r]<"u"&&r!=="src"&&typeof o=="string")t.style[r]=o;else throw new Error("✘  Cradova err : "+r+" is not a valid css style property");continue}const n=i;if(typeof t[e]=="function"){e.startsWith("on")?t[e]=n[e]:t[e].apply(t);continue}if(e==="text"){t.innerText=n[e];continue}if(e==="tree"){t.innerHTML="",t.appendChild(_([n[e]]));continue}if(e.includes("data-")){t.setAttribute(e,n[e]);continue}t[e]=n[e]}if(typeof i=="string"){t.innerText=i;return}if(typeof i=="function"){t.appendChild(_([i]));return}if(i instanceof HTMLElement&&t.appendChild(i),!(typeof i=="object"&&!Array.isArray(i)))throw new Error(` ✘  Cradova err: Cradova got invalid state  => 
`+String(i))}}var E=class{constructor(t,i){if(this.persistName="",this.actions={},this.ref=[],this.value=t,i&&i.persistName){this.persistName=i.persistName;const e=localStorage.getItem(i.persistName);if(e&&e!=="undefined"&&(this.value=JSON.parse(e)),typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(this.value,n)||(this.value[n]=t[n])}}set(t,i){typeof t=="function"?this.value=t(this.value):this.value=t,this.persistName&&localStorage.setItem(this.persistName,JSON.stringify(this.value)),this.ref.length&&i!==!1&&this._updateState(),this.callback&&this.callback(this.value)}setKey(t,i,e){if(typeof this.value=="object"&&!Array.isArray(this.value))this.value[t]=i,this.persistName&&localStorage.setItem(this.persistName,JSON.stringify(this.value)),this.ref.length&&e!==!1&&this._updateState(),this.callback&&this.callback(this.value);else throw new Error(`✘  Cradova err : can't set key ${String(t)} . store.value is not a javascript object`)}createAction(t,i){if(typeof t=="string"&&typeof i=="function")this.actions[t]=i;else throw new Error(`✘  Cradova err : can't create action, ${t} is not a function`)}createActions(t){for(const[i,e]of Object.entries(t))if(typeof i=="string"&&typeof e=="function")this.actions[i]=e;else throw new Error(`✘  Cradova err : can't create action, ${i} is not a function`)}fireAction(t,i){if(this._updateState(t,i),typeof this.actions[t]=="function")return this.actions[t].call(this,i);throw Error("✘  Cradova err : action "+t+"  does not exist!")}bind(t){if(typeof this.value=="object"&&typeof this.value[t]<"u")return[this,t];throw new Error("✘  Cradova err : can't bind an unavailable property!  "+t)}_updateState(t,i){if(t&&i)this.ref.map(e=>{var n;if(e._event===t){if(e._element_property&&e._signalProperty){(n=e.ref)==null||n.updateState({[e._element_property]:i[e._signalProperty]});return}if(e._element_property){e.ref.updateState({[e._element_property]:i});return}if(e._signalProperty){e.ref.updateState(i[e._signalProperty]);return}}});else for(let e=0;e<this.ref.length;e++){const n=this.ref[e];if(n._element_property&&n._signalProperty){n.ref.updateState({[n._element_property]:this.value[n._signalProperty]});continue}if(n._element_property){n.ref.updateState({[n._element_property]:this.value});continue}if(n._signalProperty){n.ref.updateState(this.value[n._signalProperty]);continue}if(!n._element_property&&!n._signalProperty){n.ref.updateState(this.value);continue}}}bindRef(t,i={signalProperty:"",_element_property:""}){if(t.render&&(t.render=t.render.bind(t,this.value)),t._setExtra&&t._setExtra(this),t&&t.updateState){this.ref.push({ref:t,_signalProperty:i.signalProperty,_element_property:i._element_property,_event:i.event});return}throw new Error("✘  Cradova err :  Invalid parameters for binding ref to Signal")}listen(t){this.callback=t}clearPersist(){this.persistName&&localStorage.removeItem(this.persistName)}},p=new m,g=class{constructor(t){this._secondaryChildren=[],this._errorHandler=null,this._packed=!1,this._template=document.createElement("div"),this._persist=!0,this._delegatedRoutesCount=-1;const{template:i,name:e,persist:n,renderInParallel:r,transition:o}=t;this._html=i,this._name=e,this._transition=o,this._template.setAttribute("id","cradova-screen-set"),r===!0?(this._delegatedRoutesCount=0,this._persist=!1):typeof n=="boolean"&&(this._persist=n)}get _delegatedRoutes(){return this._delegatedRoutesCount>100?-1:this._delegatedRoutesCount}set _delegatedRoutes(t){t&&(this._delegatedRoutesCount+=1)}setErrorHandler(t){this._errorHandler=t}async _package(){if(typeof this._html=="function"){let t=await this._html.apply(this);if(typeof t=="function")t=t(),f(t)&&(this._template.innerHTML="",this._template.appendChild(t));else if(f(t))this._template.innerHTML="",this._template.appendChild(t);else throw new Error(` ✘  Cradova err:  template function for the screen with name '${this._name}' returned ${t} instead of html`)}this._secondaryChildren.length&&this._template.appendChild(_(this._secondaryChildren))}onActivate(t){this._callBack=t}onDeactivate(t){this._deCallBack=t}addChildren(...t){this._secondaryChildren.push(...t)}async _deActivate(){this._deCallBack&&await this._deCallBack()}async _Activate(t=!1){(!this._persist||t||!this._packed)&&(await this._package(),this._packed=!0),this._transition&&this._template.classList.add(this._transition),document.title=this._name,p.doc.innerHTML="",p.doc.appendChild(this._template),v.dispatchEvent("onmountEvent"),window.scrollTo({top:0,left:0,behavior:"instant"}),this._callBack&&await this._callBack()}},s={};s.lastNavigatedRouteController=null;s.nextRouteController=null;s.lastNavigatedRoute=null;s.pageShow=null;s.pageHide=null;s.errorHandler=null;s.loadingScreen=null;s.params={};s.routes={};s.pageevents=[];s.start_pageevents=async function(t){setTimeout(()=>{for(let i=0;i<s.pageevents.length;i++)s.pageevents[i](t)},100)};var y=t=>{if(s.routes[t])return[s.routes[t],{path:t}];if(s.routes[t+"/"])return[s.routes[t],{path:t}];for(const i in s.routes){if(!i.includes(":"))continue;const e=t.split("/"),n=i.split("/");t.endsWith("/")&&e.pop();let r=0,o=0;if(e.shift(),n.shift(),n.length===e.length){const a={_path:""};for(let l=0;l<n.length;l++){if(n[l].includes(":")){o++;continue}e[l]===n[l]&&r++}if(r+o===n.length){for(let l=0;l<n.length;l++)n[l].includes(":")&&(a[n[l].split(":")[1]]=e[l]);return a._path=i,[s.routes[i],a]}}}return[]};s.route=(t,i)=>{if(typeof i<"u"){if(i&&!i._Activate)throw console.error(" ✘  Cradova err:  not a valid screen  ",i),new Error(" ✘  Cradova err:  Not a valid cradova screen component");return s.routes[t]=i}};s.router=async function(t,i){let e,n,r;if(e||(e=window.location.pathname),e!==s.lastNavigatedRoute)if(s.nextRouteController?(n=s.nextRouteController,s.nextRouteController=null):[n,r]=y(e),typeof n<"u")try{if(typeof n=="function"&&(s.LoadingScreen&&s.LoadingScreen._Activate&&await s.LoadingScreen._Activate(),n=await n(),!n)){s.lastNavigatedRoute&&history.pushState({},e,s.lastNavigatedRoute);return}n._delegatedRoutes!==-1&&(n._delegatedRoutes=!0,n=new g({name:n._name,template:n._html}),s.routes[e]=n),r&&(s.params.params=r),await n._Activate(i),s.start_pageevents(e),s.lastNavigatedRouteController&&s.lastNavigatedRouteController._deActivate(),s.lastNavigatedRoute=e,s.lastNavigatedRouteController=n}catch(o){if(n&&n._errorHandler)n._errorHandler(o);else if(s.errorHandler)s.errorHandler(o);else throw console.error(o),new Error(" ✘  Cradova err:  consider adding error boundary to the specific screen  ")}else s.routes["/*"]&&await s.routes["/*"]._Activate(i)};var N=class{BrowserRoutes(t){for(const i in t){let e=t[i];typeof e=="object"&&typeof e.then=="function"||typeof e=="function"?s.routes[i]=async()=>(e=await(typeof e=="function"?await e():await e),s.route(i,(e==null?void 0:e.default)||e)):s.route(i,e)}this._mount()}back(){history.go(-1)}forward(){history.go(1)}navigate(t,i=null,e=!1){if(typeof t!="string")throw new TypeError(" ✘  Cradova err:  href must be a defined path but got "+t+" instead");let n=null,r;if(t.includes("://"))window.location.href=t;else{if(t===window.location.pathname)return;[n,r]=y(t),n&&(s.nextRouteController=n,window.history.pushState({},"",t)),s.params.params=r,s.params.data=i,s.router(null,e)}}setLoadingScreen(t){if(t instanceof g)s.LoadingScreen=t;else throw new Error(" ✘  Cradova err:  Loading Screen should be a cradova screen class")}onPageEvent(t){if(typeof t=="function")s.pageevents.push(t);else throw new Error(" ✘  Cradova err:  callback for pageShow event is not a function")}async packageScreen(t,i={}){if(!s.routes[t])throw console.error(" ✘  Cradova err:  no screen with path "+t),new Error(" ✘  Cradova err:  cradova err: Not a defined screen path");let[e,n]=y(t);!e._Activate&&typeof e=="function"&&(e=await e()),e._delegatedRoutes!==-1&&(e._delegatedRoutes=!0,e=new g({name:e._name,template:e._html}),s.routes[t]=e),e._package(Object.assign(i,n||{})),e._packed=!0}getParams(){return s.params}addErrorHandler(t){if(typeof t=="function")s.errorHandler=t;else throw new Error(" ✘  Cradova err:  callback for error event is not a function")}_mount(){let t=document.querySelector("[data-wrapper=app]");t||(t=document.createElement("div"),t.setAttribute("data-wrapper","app"),document.body.appendChild(t)),p._appendDomForce("doc",t),window.addEventListener("pageshow",s.router),window.addEventListener("popstate",i=>{i.preventDefault(),s.router()})}},R=new N,x=(t,i)=>{let e={},n=null;if(i.length!==0)for(let r=0;r<i.length;r++){let o=i[r];if(typeof o=="function"&&(o=o()),o instanceof S&&(o=o.render()),f(o)){t.appendChild(o);continue}if(Array.isArray(o)){t.appendChild(C(o));continue}if(typeof o=="string"||typeof o=="number"){n=o;continue}if(typeof o=="object"){e=Object.assign(e,o);continue}if(typeof o<"u")throw console.error(" ✘  Cradova err:   got",{child:o}),new Error("  ✘  Cradova err:  invalid child type: ("+typeof o+")")}else return t;if(typeof e=="object"&&t)for(const[r,o]of Object.entries(e)){if(r==="style"&&typeof o=="object"){Object.assign(t.style,o);continue}if(Array.isArray(o)){if(o[0]instanceof E){t.updateState=w.bind(null,t),o[0].bindRef(t,{_element_property:r,signalProperty:o[1]});continue}if(r=="reference"&&o[0]instanceof m){t.updateState=w.bind(null,t),o[0]._appendDomForce(o[1],t);continue}}if(r==="onmount"&&typeof e.onmount=="function"){const a=()=>{var l;(l=e.onmount)==null||l.apply(t),e.onmount=void 0};v.addEventListener("onmountEvent",a);continue}if(r.includes("data-")){t.setAttribute(r,o);continue}if(r.includes("aria-")){t.setAttribute(r,o);continue}if(r==="href"&&typeof o=="string"){const a=o||"";a.includes("://")||t.addEventListener("click",l=>{var c;if(l.preventDefault(),R.navigate(t.pathname),a.includes("#")){const d=a.split("#").at(-1);(c=document.getElementById("#"+d))==null||c.scrollIntoView()}}),t.setAttribute(r,o);continue}if(typeof t.style[r]<"u"&&r!=="src"){t.style[r]=o;continue}t[r]=o}return n&&t.appendChild(document.createTextNode(n)),t},A=t=>(...e)=>x(document.createElement(t),e),T=A("button"),k=A("img");const b=(t,i)=>{let e;return(...n)=>{e&&clearTimeout(e),e=setTimeout(()=>{t(...n)},i)}};class D{constructor({STACK_SIZE:i,STACKING_TIME:e}={}){this._undoStack=[],this._redoStack=[],this._STACK_SIZE=1e3,this._STACKING_TIME=600,this._toolsList={},this._syntheticActionList=[],this.selection=null,this.selectedElement=null,this.range=null,this._actionList={input:[],paste:[],copy:[],contextmenu:[],"document-selectionchange":[]},i&&(this._STACK_SIZE=i),e&&(this._STACKING_TIME=e)}installOn(i="pub"){const e=document.getElementById(i);window.innerWidth<600?e.className="rabbit-editor-container mobile":e.className="rabbit-editor-container",e.contentEditable="true",this._el=e,this._createDefaultTools(),this._createDefaultActions(),this._installTools(),this._ActivateActions(),this._el.focus()}installTool(i,e){//! checking type
this._toolsList[i]=e}installAction(i,e){//! checking type
this._actionList[i]?this._actionList[i].push(e):this._actionList[i]=[e]}fireSyntheticAction(i){var e;(e=this._syntheticActionList[i])==null||e.call()}_createDefaultActions(){const i=async()=>{var a;const o=window.getSelection();if(o.rangeCount>0){const l=o.getRangeAt(0),c=l.startContainer,d=c.textContent||"";if(d&&((a=c.parentNode)==null?void 0:a.nodeName)!=="P"){const h=document.createElement("p");h.textContent=d,c.remove(),l.deleteContents(),l.insertNode(h),o.removeRange(l),this._el.focus()}}this._el.focus()},e=async()=>{var a,l;const o=window.getSelection();if(o.rangeCount>0){const c=o.getRangeAt(0),d=c.startContainer,h=d.textContent||"";h&&((a=d.parentNode)==null?void 0:a.nodeName)==="P"&&(this.selection=c.toString(),this.selectedElement=d.parentNode,this.range=c),h&&((l=d.parentNode)==null?void 0:l.nodeName)==="SPAN"&&d.parentNode}},n=b(i,500),r=b(()=>{this._saveState()},this._STACKING_TIME);this._actionList.input.push(r,n),this._actionList["document-selectionchange"].push(e)}_createDefaultTools(){const i=this;this._toolsList.redo={text:"Redo",tooling(){i._redo()}},this._toolsList.undo={text:"Undo",tooling(){i._undo(),i._undoStack.length>i._STACK_SIZE&&(i._undoStack.length=i._STACK_SIZE)}}}_installTools(){var e;const i=document.createElement("div");window.innerWidth<600?i.className="rabbit-tool-container mobile":i.className="rabbit-tool-container";for(const n in this._toolsList){let r=null;this._toolsList[n].image&&(r=k({src:this._toolsList[n].image,className:"rabbit-tool"})),this._toolsList[n].text&&(r=T(this._toolsList[n].text,{className:"rabbit-tool"})),this._toolsList[n].html&&(this._toolsList[n].html.className="rabbit-tool",r=this._toolsList[n].html),r.addEventListener("click",()=>this._apply(n)),i.appendChild(r)}(e=this._el.parentElement)==null||e.appendChild(i)}async _apply(i){const e=this._toolsList[i].tooling;e({selectedElement:this.selectedElement,selection:this.selection,range:this.range}),this._el.focus()}_saveState(){const i=this._el.innerHTML;i!==this._undoStack.at(-1)&&(this._undoStack.push(i),this._redoStack=[])}_undo(){if(this._undoStack.length>0){const i=this._el.innerHTML;this._redoStack.push(i);const e=this._undoStack.pop();e&&(this._el.innerHTML=e)}}_redo(){if(this._redoStack.length>0){const i=this._el.innerHTML;this._undoStack.push(i);const e=this._redoStack.pop();e&&(this._el.innerHTML=e)}}_ActivateActions(){for(const[i,e]of Object.entries(this._actionList))for(let n=0;n<e.length;n++)i.includes("document-")?document.addEventListener(i.split("document-")[1],e[n]):i.includes("synthetic-")?this._syntheticActionList[i]=e[0]:this._el.addEventListener(i,e[n])}}const u=new D;u.installTool("Bold",{text:"Bold Button",tooling({selectedElement:t,selection:i,range:e}){if(console.log(i,t),t&&i)if(i===t.innerText)(t==null?void 0:t.style.fontWeight)==="bold"?t.style.fontWeight="unset":t.style.fontWeight="bold";else{const n=document.createElement("span");n.innerText=i,n.style.fontWeight="bold",e.deleteContents(),e.insertNode(n)}}});u.installTool("Color",{text:"Color Button",tooling({selectedElement:t,selection:i,range:e}){console.log(i,t);const n=document.createElement("input");n.type="color",n.addEventListener("change",r=>{const o=r.target.value;if(t&&i)if(i===t.innerText)(t==null?void 0:t.style.color)===o?t.style.color="unset":t.style.color=o;else{const a=document.createElement("span");a.innerText=i,a.style.color=o,e.deleteContents(),e.insertNode(a)}}),n.click()}});u.installTool("Image",{text:"Inset image",tooling({selectedElement:t,selection:i,range:e}){console.log(i,t);const n=document.createElement("input");n.type="file",n.accept="image/*",n.click(),n.addEventListener("change",r=>{const o=r.target.files[0];if(o&&o.type.startsWith("image/")){const a=new FileReader;a.onload=l=>{const c=document.createElement("img");c.src=l.target.result,e.insertNode(c)},a.readAsDataURL(o)}}),n.click()}});u.installTool("Link",{text:"Inset link",tooling({selectedElement:t,selection:i,range:e}){console.log(i,t);const n=prompt("Enter URL:");if(n){const r=document.createElement("a");r.href=n,r.textContent=i,e.deleteContents(),e.insertNode(r)}}});u.installTool("Alignment",{text:"center Alignment",tooling({selectedElement:t,selection:i,range:e}){if(console.log(i,t),i){const n=document.createElement("div");n.style.textAlign="center",n.appendChild(e.extractContents()),e.insertNode(n)}}});u.installAction("paste",t=>{t.preventDefault();const e=(t.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertHTML",!1,e)});u.installOn("pub");
